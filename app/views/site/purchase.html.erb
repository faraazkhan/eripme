<% content_for :head do %>
	<%= javascript_include_tag 'getaquote' %>
<% end %>

<div class="fixed-width">
  <%= image_tag('wizard.png', :size => '920x46') %>
  <div class="plan-table">
    <%= form_for :customer, :url => 'purchase', :html => { :id => "getaquote_form", :style => 'color: black;' } do |customer_form| -%>
    <%= render :partial => "plans_table", :locals => {:purchase => :purchase} %>
  </div>
    <div class="sidebar-right">
    <div>
		<h4>Choose Optional Add-ons</h4>
		<% coverages = Coverage.all_optional %>
		<% bucket_size = (coverages.length.to_f / 2.0).ceil %>
		<% sets = [coverages[0..bucket_size-1], coverages[bucket_size..-1]]%>
		<% sets.each do |set| %>
			<ul class="coveragesList">
			<% set.each do |coverage| %>
				<li>
					<input onclick="updatePlanTotal()" class="coverageCheckbox" type="checkbox" value="<%=coverage.price%>" name="coverages[<%=coverage.id%>]"/>
					&nbsp;
					<%=coverage.coverage_name%>&nbsp;<%="$#{coverage.price}"%>
				</li>
			<% end %>
			</ul>
    <% end %>
  </div>
		<table class="form_table" cellspacing="5">
			<tr>
				<td class="label">Years:</td>
				<td>
					<input id="contract_length_1" onclick="updatePlanTotal();" type="radio" name="contract_length" value="1" checked="checked" class="contractLengthRadioButton"/>&nbsp;<label for="contract_length_1">1 Year</label>
					<!--&nbsp;&nbsp;
					<input id="contract_length_2" onclick="updatePlanTotal();" type="radio" name="contract_length" value="2" class="contractLengthRadioButton"/>&nbsp;<label for="contract_length_2">2 Years</label>
					&nbsp;&nbsp;
					<input id="contract_length_3" onclick="updatePlanTotal();" type="radio" name="contract_length" value="3" class="contractLengthRadioButton"/>&nbsp;<label for="contract_length_3">3 Years</label>
					-->
				</td>
			</tr>
			<tr id="paymentPlan_tr">
				<td class="label">Payment Plan:</td>
				<td>
					<select id="payment_plan_select" onchange="updatePlanTotal();">
						<option value="1">Single Payment</option>
						<option value="2">Semi-annual Payment</option>
						<option value="4">Quarterly Payment</option>
						<option value="12">Monthly Payment</option>
					</select>
				</td>
			</tr>
			<tr id="eachPayment_tr">
				<td class="label" valign="top">Each Payment:</td>
				<td><span id="eachPayment_td">$0.00</span>
					<!--<p class="noindent red">
						Best Value!! 3 and 5 year plans.<br/>Please call today for rates
					</p>-->
				</td>
			</tr>
			<tr id="price_tr">
				<td class="label">Price:</td>
				<td id="price">$0.00</td>
			</tr>
			<tr id="savings_tr">
				<td class="label">Savings:</td>
				<td id="savings">$0.00</td>
			</tr>
			<tr id="yourPrice_tr">
				<td class="red label">Your Price:</td>
				<td class="red" id="priceYearly">$0.00</td>
			</tr>
			<tr>
				<td class="label" style="width: 100px; vertical-align: top;">Discount Code:</td>
				<td id="discount_td">
					<input type="text" id="discount_code" size="8"/>
          <input type="hidden" name="customer[discount_id]" id="discount_id" value=""/>
          <% mapped = {'Single Family' => 'single', '2 Family' => 'duplex', '3 Family' => 'triplex', '4 Family' => 'fourplex', 'Condominium' => 'condo'} %> 
          <% customer_home_type = mapped[params[:type_of_home]] %>
          <input type="hidden" id="customer_home_type" value=<%="#{customer_home_type}"%> >
					<br>
					<input type="button" id="applyDiscount_button" value="Apply Discount" onclick="applyDiscount()"/>&nbsp;&nbsp;
					<br/>
					<span id="discount_span" style="color: green;"></span>
				</td>
			</tr>
    </table>
    <div id="purchase_submit">
	<input id="customer_id" type="hidden" name="id" value="<%=@customer.id%>">
	<input type="hidden" name="property_id" value="<%=@property.id%>">
	<!-- This is set by JS, so it incorporates the discount -->
	<input type="hidden" id="customer_num_payments" name="customer[num_payments]" value="1">
	<input type="hidden" id="customer_pay_amount" name="customer[pay_amount]" value=""/>
	<input type="hidden" id="customer_disabled" name="customer[disabled]" value="0"/>
	<input id="getaquote_button" type="button" onclick="validateGetAQuoteForm();" value="Start Coverage"/>
</div>

    <td colspan="4">
      <div class="get-quote">
      <%= link_to "Get a Free Quote Now", purchase_path(params), :method=> :post %></td>
    </div>
			</td>
</div>

<% end %>

</div>
</div>
</div>
